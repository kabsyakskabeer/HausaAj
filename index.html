<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ajami writer</title>
    <style>
        @font-face {
  font-family: AlkalamiRW;
        src: url(Alkalami-Regular.woff2);
    }
     #boko{
            width: 99%;
            height: 20vh;
            font-family: AlkalamiRW, sans-serif; 
        }
    #ajamimi{
            height: 20vh;
            width: 99%;
            font-family: AlkalamiRW, sans-serif; 
            text-align: right;
            font-size: 150%;
        }
    </style>
</head>
<body>
    <div><h3>Hausa Boko - Hausa Ajami converter</h3></div>
    <div id="ajamimi">
        <div id="ajamiBox"><p id="ajami"></p></div>
       
    </div>
  
    <textarea name="boko" id="boko" cols="30" rows="10"></textarea>  
    

    <script>
      
        
        let first = "";
        let second = "";
        let third = "";
        let fourth = "";
        let memory = [];
        

        let bokoArea =document.getElementById("boko");
        let ajamiArea =document.getElementById("ajami");
    
       

        function isVowel(x) {
             let result;
            result = x == "َ" || x == "ٜ" || x == "ِ" || x == "ࣷ" || x == "ُ" || x == "ى" || x=="ْ";
            return result;
        }
        function isConsonant(x){
            let result = x == "ب"||x=="ش"|| x == "ث"|| x == "د"|| x == "ࢻ"|| x == "غ"|| x == "ه"|| x == "ج"|| x == "ک"|| x == "ل"|| x == "م"|| x == "ࢽ"|| x == "ر"|| x == "س"|| x == "ت"|| x == "و"|| x == "ی"|| x == "ز";
            return result;
        }
        function isSpace(x){
            let result = x == " ";
            return result;
        }
        function isFullStop(x){
            let result = x == "." ;
            return result;
         }
        function isBegining(x){
            let result = x ==" " || x=="";
                return result;
        }
        
        
        function getAjami(ch,first,second,third){
            ///a
            
            if(ch == "a"|| ch == "A"){
                if(isVowel(first)||isBegining(first)){
          
                    return "أَ";
                }else{
                    return "َ"
                }
                

            }else if(ch == "b"|| ch == "B"){
                if(first == "ب"){
                    return "ّ"; 

                }else if(isConsonant(first)){
                    return "ْب"

                }else{
                    
                    return "ب";
                }  
                
            }else if(ch == "ɓ"){
                if(first == "ݒ"){
                    return "ّ";

                }else if(isConsonant(first)){
                    return "ْݒ"

                }else{
                   
                    return "ݒ";
                }  
                
            }else if(ch == "c"|| ch == "C"){

                if(first == "ث"){
                    return "ّ"; 

                }else if(isConsonant(first)){
                    return "ْث"

                }else{
                    
                    return "ث";
                }  
                
            }else if(ch == "d"|| ch == "D"){
                if(first == "د"){
                    return "ّ";

                }else if(isConsonant(first)){
                    return "ْد"

                }else{
                    return "د";
                }  
                
            }else if(ch == "ɗ"){
                if(first == "ط"){
                    return "ّ";

                }else if(isConsonant(first)){
                    return "ْط"

                }else{
                   
                    return "ط";
                }  
                
            }else if(ch == "e"|| ch == "E"){
                return "ٜ";
                
            }else if(ch == "f" || ch == "F"){
                if(first == "ࢻ"){
                    return "ّ";

                }else if(isConsonant(first)){
                    return "ْࢻ"

                }else{
                   
                    return "ࢻ";
                }  
                
            }else if(ch == "g"|| ch == "G"){
                if(first == "غ"){
                    return "ّ";

                }else if(isConsonant(first)){
                    return "ْغ"

                }else{
                    return "غ";
                }  
                
            }else if(ch == "h" || ch == "H"){
                if(first=="س"){
            
                    return "ش"
                   // console.log(ajamiArea.textContent);


                }else if(first == "ه"){
                    return "ّ";

                }else if(isConsonant(first)){
                    return "ْه"

                }else{
                    return "ه";
                }  
                
            }else if(ch == "i"|| ch == "I"){
                if(isBegining(first)){
                    return "إِ"
                }if(isVowel(first)){
                    return "ى"
                }else{
                    return "ِ"
                }
                
            }else if(ch == "j"|| ch == "J"){
                if(first == "ج"){
                    return "ّ";

                }else if(isConsonant(first)){
                    return "ْج"

                }else{
                    return "ج";
                }  
                
            }else if(ch == "k"|| ch == "K"){
                if(first == "ک"){
                    return "ّ";

                }else if(isConsonant(first)){
                    return "ْک"

                }else{
                    //return "ّ";
                    return "ک";
                }  
                
            }else if(ch == "ƙ"){
                if(first == "ࢼ"){
                    return "ّ";

                }else if(isConsonant(first)){
                    return "ْࢼ"

                }else{
                   
                    return "ࢼ";
                }  
                
            }
            else if(ch == "l"|| ch == "L"){
                if(first == "ل"){
                    return "ّ";

                }else if(isConsonant(first)){
                    return "ْل"

                }else{
                   
                    return "ل";
                }  
                
            }else if(ch == "m"|| ch == "M"){
                if(first == "م"){
                    return "ّ";

                }else if(isConsonant(first)){
                    return "ْم"

                }else{
                   
                    return "م";
                }  
                
            }else if(ch == "n"|| ch == "N"){
                if(first == "ࢽ"){
                    return "ّ";

                }else if(isConsonant(first)){
                    return "ْࢽ"

                }else{
                   
                    return "ࢽ";
                }  
                
            }else if(ch == "o"|| ch == "O"){
                if(isBegining(first)){
                    return "عُو"
                }else{
                    return "ࣷ";
                }
                    
            }else if(ch == "p"|| ch == "P"){
                if(first =="ࢻ"){
                    return "ّ";

                }else if(isConsonant(first)){
                    return "ْࢻ"

                }else{
                   
                    return "ࢻ";
                }  
                
            }else if(ch == "q"|| ch == "Q"){
                if(first == "ࢼ"){
                    return "ّ";

                }else if(isConsonant(first)){
                    return "ْࢼ";

                }else{
                   
                    return "ࢼ";
                }  
                
            }else if(ch == "r"|| ch == "R"){
                // if(first == "ر"){
                //     return "ّ";

                // }else 
                if(isConsonant(first)){
                    return "ْر"

                }else if(first == "ِ"){
                    return "یر"

                }else{
                   
                    return "ر";
                }  
                
            }else if(ch == "s"|| ch == "S"){
                
                if(first == "س"){
                    return "ّ";

                }else if(isConsonant(first)){
                    return "ْس"

                }else{
                   
                    return "س";
                    console.log(first);
                }  
                
            }else if(ch == "sh"){
                
                if(first == "ش"){
                    return "ّ";

                }else if(isConsonant(first)){
                    return "ْ"

                }else{
                   
                    return "ش";
                   // console.log(first);
                }  
                
            }else if(ch == "t"|| ch == "T"){
                if(first == "ت"){
                    return "ّ";

                }else if(isConsonant(first)){
                    return "ْت"

                }else{
                   
                    return "ت";
                }  
                
            }else if(ch == "u"|| ch == "U"){

                if(isBegining(first)){
                    return "عُ"
                }else if(first=="َ"){
                    return "و"

                }else if(isVowel(first)){
                    return "عُ"

                }else{
                return "ُ";
                }
                
            }else if(ch == "v"|| ch == "V"){
                if(first == "ب"){
                    return "ّ";

                }else if(isConsonant(first)){
                    return "ْب"

                }else{
                   
                    return "ب";
                }  
                
            }else if(ch == "w"|| ch == "W"){
                if(first == "و"){
                    return "ّ";

                }else if(isConsonant(first)){
                    return "ْو"

                }else{
                   
                    return "و";
                }  
                
            }else if(ch == "y"|| ch == "Y"){
                if(first == "ی"){
                    return "ّ";

                }else if(isConsonant(first)){
                    return "ْی"

                }else{
                   
                    return "ی";
                }  
                
            }else if(ch == "z"|| ch == "Z"){
                if(first == "ز"){
                    return "ّ";

                }else if(isConsonant(first)){
                    return "ْز"

                } else{
                   
                    return "ز";
                }  
                
                //space
            }else if(isSpace(ch)){
              if (isConsonant(first)) {
                    return "ْ "
                } else {
                    return " "
                }
                // apostrophe
            }else if(ch=="'"){
                if (isVowel(first)) {
                    return "ىٕ" 
                } else if(isConsonant(first)){
                    return "ْأ"

                }else{
                    return "'" 
                }

            }else if(ch =="."){
                if (isVowel(first)) {
                    return "."
                } else if(isConsonant(first) && isSpace(second)){
                    return "."

                }else if(isConsonant(first)){
                    return "ْ"

                }else{
                    return "" 
                }

            }else{
                return "";
            }
            
           
            
        }

       // remember each input counts and use it during deletion
    
       function deleteCharcter(str,first,second,third,x){
            return str.substring(0, str.length - x);
            first = str[str.length-x];

        
       }
       
      // console.log(cutter("kabiru",2,4));
       /*
** Returns the caret (cursor) position of the specified text field (oField).
** Return value range is 0-oField.value.length.
*/
    function  doGetCaretPosition(oField){
      //  let oField = bokoArea;

        // Initialize
        var iCaretPos = 0;

        // IE Support
        if (document.selection) {

        // Set focus on the element
        oField.focus();

        // To get cursor position, get empty selection range
        var oSel = document.selection.createRange();

        // Move selection start to 0 position
        oSel.moveStart('character', -oField.value.length);

        // The caret position is selection length
        iCaretPos = oSel.text.length;
        }

        // Firefox support
        else if (oField.selectionStart || oField.selectionStart == '0')
        iCaretPos = oField.selectionDirection=='backward' ? oField.selectionStart : oField.selectionEnd;

        // Return results

       // pos = iCaretPos;
        return iCaretPos;
    //   let ajamiCaretPos =  sumOfMem(memory,pos);
    // first = ajamiArea.textContent.charAt(ajamiCaretPos);//ajamiArea.textContent.charAt(doGetCaretPosition(this) -1 +sumOfMem(memory,0)-memory.length);    
    // second = ajamiArea.textContent.charAt(ajamiCaretPos-1);
    // third = ajamiArea.textContent.charAt(ajamiCaretPos-2);
    // fourth =  ajamiArea.textContent.charAt(sumOfMem(ajamiCaretPos+1));
    }

    function sumOfMem(arr,end){
        let sum = 0
    
       for (let index = 0; index < end; index++) {
        const element = arr[index];
        sum += element;
        
       }
       return sum;

       
    }
   

    function insertAtAjami(str, index, value) {
    return str.substring(0,index) + value + str.substring(index)
    }
    function stringCutter(str,cutCount,caretPos){
        let firstPart = str.substring(0,caretPos-cutCount);
        let secondPart = str.substring(caretPos,str.length);
       // memory.splice(pos,1);
        return firstPart + secondPart;
    }
    
    let pos =0;
       
    
    bokoArea.addEventListener('keypress', checkcaret); // Every character written
    bokoArea.addEventListener('mousedown', checkcaret); // Click down        
    bokoArea.addEventListener('touchstart', checkcaret); // Mobile//
//bokoArea.addEventListener('input', checkcaret); // Other input events
bokoArea.addEventListener('paste', checkcaret); // Clipboard actions
bokoArea.addEventListener('cut', checkcaret);
bokoArea.addEventListener('mousemove', checkcaret); // Selection, dragging text
bokoArea.addEventListener('select', checkcaret); // Some browsers support this event
bokoArea.addEventListener('selectstart', checkcaret); // Some browsers support this event
bokoArea.addEventListener('keydown',checkcaret); //selectionchange
bokoArea.addEventListener('selectionchange',checkcaret); //selectionchange
bokoArea.addEventListener('keyup',checkcaret); //selectionchange
bokoArea.addEventListener('click',checkcaret); //selectionchange
bokoArea.addEventListener('dblclick',checkcaret); //selectionchange


function checkcaret() {
  const newPos = bokoArea.selectionStart;
  if (newPos !== pos) {
    console.log('change to ' + newPos);
    pos = newPos;
    console.log("caret position: "+newPos);
    console.log("first: "+ first);
  }
  let ajamiCaretPos =  sumOfMem(memory,pos);
    first = ajamiArea.textContent.charAt(ajamiCaretPos);//ajamiArea.textContent.charAt(doGetCaretPosition(this) -1 +sumOfMem(memory,0)-memory.length);    
    second = ajamiArea.textContent.charAt(ajamiCaretPos-1);
    third = ajamiArea.textContent.charAt(ajamiCaretPos-2);
    fourth =  ajamiArea.textContent.charAt(sumOfMem(ajamiCaretPos+1));
    
}
   
    bokoArea.addEventListener('input', function(ii){
        checkcaret; // update carret

      
        let txt = bokoArea.value;
     //   console.log(txt);
      //  first = getAjami([ii.data],first,second,third);
      first = getAjami(txt.substring(memory.length),first,second,third);
    ///  console.log(txt.substring(memory.length));

        

        let bokoCaretPos = doGetCaretPosition(this);
        let ajamiCaretPos =  sumOfMem(memory,pos);

        if(ii.inputType == 'deleteContentBackward'){
            ajamiArea.textContent = stringCutter(ajamiArea.textContent,memory[bokoCaretPos],ajamiCaretPos);
            memory.splice(bokoCaretPos,1);
          
          
            // first = ajamiArea.textContent.charAt(sumOfMem(ajamiCaretPos-1));//ajamiArea.textContent.charAt(doGetCaretPosition(this) -1 +sumOfMem(memory,0)-memory.length);
            //  second = ajamiArea.textContent.charAt(sumOfMem(ajamiCaretPos-2));
            //  third = ajamiArea.textContent.charAt(sumOfMem(ajamiCaretPos-3));
            first = ajamiArea.textContent.charAt(ajamiCaretPos-1);//ajamiArea.textContent.charAt(doGetCaretPosition(this) -1 +sumOfMem(memory,0)-memory.length);    
            second = ajamiArea.textContent.charAt(ajamiCaretPos-2);
             third = ajamiArea.textContent.charAt(ajamiCaretPos-3);
             fourth =  ajamiArea.textContent.charAt(ajamiCaretPos+1);
         
        }else{
            
            ajamiArea.textContent =  insertAtAjami(ajamiArea.textContent,ajamiCaretPos,first);
            
            memory.push(first.length);

            //  first = ajamiArea.textContent.charAt(sumOfMem(ajamiCaretPos-1));//ajamiArea.textContent.charAt(doGetCaretPosition(this) -1 +sumOfMem(memory,0)-memory.length);
            //  second = ajamiArea.textContent.charAt(sumOfMem(ajamiCaretPos-2));
            //  third = ajamiArea.textContent.charAt(sumOfMem(ajamiCaretPos-3));
            first = ajamiArea.textContent.charAt(ajamiCaretPos);//ajamiArea.textContent.charAt(doGetCaretPosition(this) -1 +sumOfMem(memory,0)-memory.length);    
            second = ajamiArea.textContent.charAt(ajamiCaretPos-1);
             third = ajamiArea.textContent.charAt(ajamiCaretPos-2);
             fourth =  ajamiArea.textContent.charAt(sumOfMem(ajamiCaretPos+1));
            

     
        }
    

        });

    </script>
    
</body>

</html>